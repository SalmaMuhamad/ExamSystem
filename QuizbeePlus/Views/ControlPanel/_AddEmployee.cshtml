@model QuizbeePlus.Entities.QuizbeeUser
@{
    ViewBag.Title = "AddEmployee";

}

<div class="row">
    @Html.Partial("_Loader", "questionsLoader")
    <div class="col-md-12">
        <div class="card">
            <div class="card-body">
                <div class="col-md-12">
                    <h4>Add Users via Excel</h4>
                    <hr />
                    @using (Html.BeginForm("UploadExcel", "ControlPanel", FormMethod.Post, new { enctype = "multipart/form-data", onsubmit = "return myFunction()" }))
                    {
                <div class="form-horizontal">
                    <div class="form-group">
                        <div class="control-label col-md-2">Download Format:</div>
                        <div class="col-md-10">
                            <a href="~/User/DownloadExcel/">
                                <img src="/Content/images/users/excel.png" width="25" height="25" title="Download Excel format" alt="User.xlsx" />
                            </a>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="control-label col-md-2">Excel:</div>
                        <div class="col-md-10">
                            <input type="file" id="FileUpload" name="FileUpload" class="" />
                        </div>
                    </div>

                    <table class="table">
                        <thead>
                            <tr>
                                
                                <th scope="col">UserName</th>
                                <th scope="col">NationalID</th>
                                <th scope="col">Password</th>
                                <th scope="col">Email</th>
                                <th scope="col">PhoneNumber</th>
                                <th scope="col">El-Geha</th>
                                <th scope="col">Sector</th>
                                <th scope="col">JobTitle</th>
                            </tr>
                        </thead>
                        <tbody id="x">

                        </tbody>

                            @*<script>
                $("#FileUpload").change(function () {
                    const [file] = FileUpload.files
                    if (file) {
                        window.open(URL.createObjectURL(file));

                    }
                });*@

                            @*//FileUpload.onchange = evt => {
                //    const [file] = imgInp.files
                //    if (file) {
                //        blah.src = URL.createObjectURL(file)
                //    }
                //}*@
                            @*</script>*@
                            <div class="form-group">
                                <div class="col-md-offset-2 col-md-10">
                                    <input type="submit" value="Upload" id="btnUpload" class="btn btn-primary" />
                                    <br /> <br />
                                    <span>SHOW DATA IN YOUR EXCEL :</span>
                                    <br />
                                    <input value="Show" id="btnShow" class="btn btn-primary" name="files[]" type="file" />
                                </div>
                            </div>
                </div>
                    }
                </div>


            </div>
        </div>
    </div>

</div>

<script src="~/Scripts/jquery-1.10.2.min.js"></script>
@*<script>


          function ss() {

              debugger;
            //Call UploadExcel jsonResult Method
             $.getJSON("ControlPanel/UploadExcel",

                 function (json) {

                    var tr;
                    //Append each row to html table
                    for (var i = 0; i < json.length; i++) {
                        tr = $('<tr/>');
                        tr.append("<td>" + json[i].Id + "</td>");
                        tr.append("<td>" + json[i].UserName + "</td>");
                        tr.append("<td>" + json[i].NationalID + "</td>");
                        tr.append("<td>" + json[i].PasswordHash + "</td>");
                        tr.append("<td>" + json[i].Email + "</td>");
                        tr.append("<td>" + json[i].PhoneNumber + "</td>");
                        tr.append("<td>" + json[i].Sector + "</td>");
                        tr.append("<td>" + json[i].Elgeha + "</td>");
                        tr.append("<td>" + json[i].JobTitle + "</td>");
                        $('x').append(tr);
                    }
                });
         };

    </script>*@


<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/jszip.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/xlsx.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

<script>
    var ExcelToJSON = function () {

        this.parseExcel = function (file) {
            var reader = new FileReader();

            reader.onload = function (e) {
                var data = e.target.result;
                var workbook = XLSX.read(data, {
                    type: 'binary'
                });
                workbook.SheetNames.forEach
                    (function (sheetName) {
                        // Here is your object
                        var XL_row_object = XLSX.utils.sheet_to_row_object_array(workbook.Sheets[sheetName]);
                        var json_object = JSON.stringify(XL_row_object);
                        var json = JSON.parse(json_object)
                        for (var i = 0; i < json.length; i++) {
                            var obj = json[i];

                            var Record = "<tr><td>" +  obj.NationalID + "</td><td>" + obj.UserName + "</td><td>" + obj.Email + "</td><td>" + obj.PasswordHash + "</td><td>" +'0' +obj.PhoneNumber + "</td><td>" + obj.Elgeha + "</td><td>" + obj.Sector + "</td><td>" + obj.JobTitle + "</td></tr>";

                            $("#x").append(Record);
                            
                        }
                    }
                    )
            };

            reader.onerror = function (ex) {
                console.log(ex);
            };

            reader.readAsBinaryString(file);
        };
    };

    function handleFileSelect(evt) {

        var files = evt.target.files; // FileList object
        var xl2json = new ExcelToJSON();
        xl2json.parseExcel(files[0]);
    }



</script>

<script>
    document.getElementById('btnShow').addEventListener('change', handleFileSelect, false);

</script>